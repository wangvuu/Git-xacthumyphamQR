{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-f480fbd55ac1f9fe4c56d0d40d07690de3eff37f",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/CosmeticAuthentication.sol": "project/contracts/CosmeticAuthentication.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/CosmeticAuthentication.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.19;\r\n\r\ncontract CosmeticAuthentication {\r\n    struct Product {\r\n        string productId;\r\n        string productName;\r\n        string brand;\r\n        string batchNumber;\r\n        uint256 manufacturingDate;\r\n        uint256 expiryDate;\r\n        string manufacturer;\r\n        address owner;\r\n        bool isAuthentic;\r\n        uint256 verificationCount;\r\n        uint256 createdAt;\r\n    }\r\n\r\n    struct VerificationLog {\r\n        address verifier;\r\n        uint256 timestamp;\r\n        string location;\r\n    }\r\n\r\n    mapping(string => Product) public products;\r\n    mapping(string => VerificationLog[]) public verificationHistory;\r\n\r\n    address public admin;\r\n    uint256 public totalProducts;\r\n\r\n    event ProductRegistered(\r\n        string indexed productId,\r\n        string productName,\r\n        string brand,\r\n        address owner\r\n    );\r\n\r\n    event ProductVerified(\r\n        string indexed productId,\r\n        address verifier,\r\n        uint256 timestamp\r\n    );\r\n\r\n    event ProductTransferred(\r\n        string indexed productId,\r\n        address from,\r\n        address to\r\n    );\r\n\r\n    modifier onlyAdmin() {\r\n        require(msg.sender == admin, \"Only admin can perform this action\");\r\n        _;\r\n    }\r\n\r\n    constructor() {\r\n        admin = msg.sender;\r\n    }\r\n\r\n    // ✅ AI CŨNG CÓ THỂ ĐĂNG KÝ SẢN PHẨM\r\n    function registerProduct(\r\n        string memory _productId,\r\n        string memory _productName,\r\n        string memory _brand,\r\n        string memory _batchNumber,\r\n        uint256 _manufacturingDate,\r\n        uint256 _expiryDate,\r\n        string memory _manufacturer\r\n    ) external {\r\n        require(bytes(_productId).length > 0, \"Product ID cannot be empty\");\r\n        require(bytes(products[_productId].productId).length == 0, \"Product already exists\");\r\n\r\n        products[_productId] = Product({\r\n            productId: _productId,\r\n            productName: _productName,\r\n            brand: _brand,\r\n            batchNumber: _batchNumber,\r\n            manufacturingDate: _manufacturingDate,\r\n            expiryDate: _expiryDate,\r\n            manufacturer: _manufacturer,\r\n            owner: msg.sender,\r\n            isAuthentic: true,\r\n            verificationCount: 0,\r\n            createdAt: block.timestamp\r\n        });\r\n\r\n        totalProducts++;\r\n\r\n        emit ProductRegistered(_productId, _productName, _brand, msg.sender);\r\n    }\r\n\r\n    function verifyProduct(string memory _productId, string memory _location)\r\n        external\r\n        returns (bool)\r\n    {\r\n        require(bytes(products[_productId].productId).length > 0, \"Product does not exist\");\r\n\r\n        Product storage product = products[_productId];\r\n        product.verificationCount++;\r\n\r\n        verificationHistory[_productId].push(\r\n            VerificationLog({\r\n                verifier: msg.sender,\r\n                timestamp: block.timestamp,\r\n                location: _location\r\n            })\r\n        );\r\n\r\n        emit ProductVerified(_productId, msg.sender, block.timestamp);\r\n        return product.isAuthentic;\r\n    }\r\n\r\n    function getProduct(string memory _productId)\r\n        external\r\n        view\r\n        returns (\r\n            string memory productName,\r\n            string memory brand,\r\n            string memory batchNumber,\r\n            uint256 manufacturingDate,\r\n            uint256 expiryDate,\r\n            string memory manufacturer,\r\n            bool isAuthentic,\r\n            uint256 verificationCount\r\n        )\r\n    {\r\n        Product memory product = products[_productId];\r\n        require(bytes(product.productId).length > 0, \"Product does not exist\");\r\n\r\n        return (\r\n            product.productName,\r\n            product.brand,\r\n            product.batchNumber,\r\n            product.manufacturingDate,\r\n            product.expiryDate,\r\n            product.manufacturer,\r\n            product.isAuthentic,\r\n            product.verificationCount\r\n        );\r\n    }\r\n\r\n    function getVerificationHistory(string memory _productId)\r\n        external\r\n        view\r\n        returns (VerificationLog[] memory)\r\n    {\r\n        return verificationHistory[_productId];\r\n    }\r\n\r\n    function transferProduct(string memory _productId, address _newOwner) external {\r\n        require(bytes(products[_productId].productId).length > 0, \"Product does not exist\");\r\n        require(products[_productId].owner == msg.sender, \"Not the product owner\");\r\n\r\n        address previousOwner = products[_productId].owner;\r\n        products[_productId].owner = _newOwner;\r\n\r\n        emit ProductTransferred(_productId, previousOwner, _newOwner);\r\n    }\r\n\r\n    // ✅ Chỉ admin mới được đánh dấu hàng giả\r\n    function markAsCounterfeit(string memory _productId) external onlyAdmin {\r\n        require(bytes(products[_productId].productId).length > 0, \"Product does not exist\");\r\n        products[_productId].isAuthentic = false;\r\n    }\r\n\r\n    function isProductExpired(string memory _productId) external view returns (bool) {\r\n        require(bytes(products[_productId].productId).length > 0, \"Product does not exist\");\r\n        return block.timestamp > products[_productId].expiryDate;\r\n    }\r\n}\r\n"
      }
    }
  }
}